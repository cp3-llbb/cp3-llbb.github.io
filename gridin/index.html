
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the CP3-llbb Analysis Tools">
      
      
      
        <meta name="author" content="IRMP/CP3, Université catholique de Louvain">
      
      
        <link rel="canonical" href="https://cp3-llbb.github.io/gridin/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.0">
    
    
      
        <title>GridIn - CP3-llbb Analysis Tools</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8b42a75e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gridin-tools-for-running-over-grid" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CP3-llbb Analysis Tools" class="md-header__button md-logo" aria-label="CP3-llbb Analysis Tools" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CP3-llbb Analysis Tools
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GridIn
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        
<a href="https://github.com/cp3-llbb/cp3-llbb.github.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cp3-llbb/cp3-llbb.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CP3-llbb Analysis Tools" class="md-nav__button md-logo" aria-label="CP3-llbb Analysis Tools" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    CP3-llbb Analysis Tools
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cp3-llbb/cp3-llbb.github.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cp3-llbb/cp3-llbb.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Framework
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Framework" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Framework
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../framework/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fwk_jenkins/" class="md-nav__link">
        Jenkins CI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../doxyfwk/index.html" class="md-nav__link">
        Doxygen
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        GridIn
      </a>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plotit/" class="md-nav__link">
        plotIt
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cp3-llbb/cp3-llbb.github.io/edit/master/docs/gridin.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="gridin-tools-for-running-over-grid">GridIn: tools for running over grid<a class="headerlink" href="#gridin-tools-for-running-over-grid" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>This guide suppose that the framework is already installed. See <a href="../framework/">the framework guide</a> for detailed instructions</li>
<li>This guide installs the <a href="https://github.com/cp3-llbb/GridIn">GridIn</a> tools, our <a href="https://github.com/cp3-llbb/Datasets">Datasets</a> repo to list the datasets to be ran on, and <a href="https://github.com/cp3-llbb/SAMADhi">SAMADhi</a>, our local database</li>
<li>You probably want to have the access to this database: ask around!</li>
<li>The utilities in the <code>scripts</code> folders are copied to <code>CMSSW/bin</code> during the <code>scram b</code>, so if these utilities have been modified you need to rebuild in order to have them in your PATH</li>
</ul>
</div>
<h1 id="first-time-setup">First time setup<a class="headerlink" href="#first-time-setup" title="Permanent link">&para;</a></h1>
<div class="highlight"><pre><span></span><span class="nb">source</span> /nfs/soft/grid/ui_sl6/setup/grid-env.sh
<span class="nb">source</span> /cvmfs/cms.cern.ch/cmsset_default.sh
<span class="nb">source</span> /cvmfs/cms.cern.ch/crab3/crab.sh

<span class="nb">cd</span> &lt;path_to_CMSSW&gt;
cmsenv

<span class="nb">cd</span> <span class="si">${</span><span class="nv">CMSSW_BASE</span><span class="si">}</span>/src
git clone -o upstream git@github.com:cp3-llbb/GridIn.git cp3_llbb/GridIn
git clone -o upstream git@github.com:cp3-llbb/SAMADhi.git cp3_llbb/SAMADhi
git clone -o upstream git@github.com:cp3-llbb/Datasets.git cp3_llbb/Datasets

scram b -j <span class="m">4</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">CMSSW_BASE</span><span class="si">}</span>/src/cp3_llbb/GridIn
<span class="nb">source</span> first_setup.sh
</pre></div>
<h1 id="how-to">How-to<a class="headerlink" href="#how-to" title="Permanent link">&para;</a></h1>
<p>The script you'll be working with is <code>runOnGrid.py</code>, from the <code>scripts</code> folder. During the first build, this script
is copied by CMSSW into the global <code>scripts</code> directory, which is inside <code>PATH</code>; you can thus access it from anywhere
in the source tree</p>
<p>In order to run on the grid, you need 3 things:</p>
<ul>
<li>First, an <code>analyzer</code> for the framework</li>
<li>A <code>configuration</code> file for this analyzer</li>
<li>A set of JSON files describing the datasets you want to run on</li>
</ul>
<p>The first two points must be handled by you. For the last point, a set of JSON files for the commonly used datasets are
already included (see inside <code>test/datasets</code>). The structure of the JSON file is described <a href="#json-file-format">below</a></p>
<p>You can now run on the grid. Go to the <code>test</code> folder, and run</p>
<div class="highlight"><pre><span></span>runOnGrid.py -c &lt;Your_Configuration_File&gt; --mc datasets/mc_TT.json datasets/mc_DY.json &lt;datasets/...&gt;
</pre></div>
<p><code>&lt;Your_Configuration_File&gt;</code> must be substituted by the name of the configuration file, <em>including the <code>.py</code> extension</em>.
You should now have a new file inside the working directory, named <code>crab_TTJets_TuneCUETP8M1_amcatnloFXFX_25ns.py</code>.
This file is a configuration file for <code>crab3</code>. A file is created automatically for each dataset specified when running
 <code>runOnGrid.py</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>By default, <code>runOnGrid.py</code> does not submit any jobs to the grid, it only creates the necessary files for crab.</strong> If you want to automatically submit the jobs, you can add the <code>--submit</code> flag when running <code>runOnGrid.py</code> (<strong>does not seems to work for the moment due to a crab bug</strong>).</p>
</div>
<p>To manually launch the jobs, use the <code>crab submit &lt;crab_python_file&gt;</code>. All the submitted tasks are stored inside the <code>tasks</code> folder.</p>
<h1 id="book-keeping">Book-keeping<a class="headerlink" href="#book-keeping" title="Permanent link">&para;</a></h1>
<p>If the job has completed successfully, you can run
<div class="highlight"><pre><span></span>runPostCrab.py &lt;myCrabConfigFile.py&gt;
</pre></div>
This will gather the needed information (number of events, code version, source dataset, ...) and insert the sample (and possibly the parent dataset if missing) in the database</p>
<h1 id="json-file-format">JSON file format<a class="headerlink" href="#json-file-format" title="Permanent link">&para;</a></h1>
<p>Each dataset is stored inside a JSON file, containing at least the dataset pretty name, its path as well as the number
of <em>units</em> per job. The meaning of <em>units</em> depends on the type of dataset: for <code>data</code>, a unit is a luminosity section.
For <code>MC</code>, a unit is a file.</p>
<p>An example of JSON file is given below:
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;/TTJets_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/RunIISpring15DR74-Asympt25ns_MCRUN2_74_V9-v1/MINIAODSIM&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TTJets_TuneCUETP8M1_amcatnloFXFX_25ns&quot;</span><span class="p">,</span>
    <span class="nt">&quot;units_per_job&quot;</span><span class="p">:</span> <span class="mi">15</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></p>
<p>It can contains any number of datasets, but by convention, only datasets belonging into the same group should be into
the same file (for example, it's fine to have one file for exclusive DY datasets, but not one file for all the different
TT samples). The root node must be a dictionary, where the key is the dataset path, and values are:</p>
<ul>
<li><code>name</code>: The pretty name of the dataset. This name is used to format the task name and the output path</li>
<li><code>units_per_job</code>: For <code>MC</code>, the number of files processed by each job. For <code>data</code>, the number of luminosity section
processed by each job.</li>
</ul>
<p>For a <code>data</code> JSON file, an additional value is mandatory:</p>
<ul>
<li><code>run_range</code>: must be an array with two entries, like <code>[1, 30]</code>, defining the range of validity of the dataset</li>
</ul>
<p>An optional value, but highly recommended is:</p>
<ul>
<li><code>certified_lumi_file</code>: the path (filename or url) of the golden JSON file containing certified luminosity section.
If not present, a default file will be used, presumably outdated by the time you'll run.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../fwk_jenkins/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Jenkins CI" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Jenkins CI
            </div>
          </div>
        </a>
      
      
        
        <a href="../plotit/" class="md-footer__link md-footer__link--next" aria-label="Next: plotIt" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              plotIt
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 IRMP/CP3, Université catholique de Louvain
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/cp3-llbb" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.f8263e09.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4fc53ad4.min.js"></script>
      
    
  </body>
</html>