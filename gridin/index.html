



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the CP3-llbb Analysis Tools">
      
      
        <link rel="canonical" href="https://cp3-llbb.github.io/gridin/">
      
      
        <meta name="author" content="IRMP/CP3, Université catholique de Louvain">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>GridIn - CP3-llbb Analysis Tools</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#gridin-tools-for-running-over-grid" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://cp3-llbb.github.io/" title="CP3-llbb Analysis Tools" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              CP3-llbb Analysis Tools
            </span>
            <span class="md-header-nav__topic">
              
                GridIn
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/cp3-llbb/cp3-llbb.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    cp3-llbb/cp3-llbb.github.io
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://cp3-llbb.github.io/" title="CP3-llbb Analysis Tools" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    CP3-llbb Analysis Tools
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/cp3-llbb/cp3-llbb.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    cp3-llbb/cp3-llbb.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Framework
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Framework
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../framework/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fwk_jenkins/" title="Jenkins CI" class="md-nav__link">
      Jenkins CI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../doxyfwk/index.html" title="Doxygen" class="md-nav__link">
      Doxygen
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="GridIn" class="md-nav__link md-nav__link--active">
      GridIn
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../plotit/" title="plotIt" class="md-nav__link">
      plotIt
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cp3-llbb/cp3-llbb.github.io/edit/master/docs/gridin.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="gridin-tools-for-running-over-grid">GridIn: tools for running over grid<a class="headerlink" href="#gridin-tools-for-running-over-grid" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>This guide suppose that the framework is already installed. See <a href="../framework/">the framework guide</a> for detailed instructions</li>
<li>This guide installs the <a href="https://github.com/cp3-llbb/GridIn">GridIn</a> tools, our <a href="https://github.com/cp3-llbb/Datasets">Datasets</a> repo to list the datasets to be ran on, and <a href="https://github.com/cp3-llbb/SAMADhi">SAMADhi</a>, our local database</li>
<li>You probably want to have the access to this database: ask around!</li>
<li>The utilities in the <code>scripts</code> folders are copied to <code>CMSSW/bin</code> during the <code>scram b</code>, so if these utilities have been modified you need to rebuild in order to have them in your PATH</li>
</ul>
</div>
<h1 id="first-time-setup">First time setup<a class="headerlink" href="#first-time-setup" title="Permanent link">&para;</a></h1>
<div class="codehilite"><pre><span></span><span class="nb">source</span> /nfs/soft/grid/ui_sl6/setup/grid-env.sh
<span class="nb">source</span> /cvmfs/cms.cern.ch/cmsset_default.sh
<span class="nb">source</span> /cvmfs/cms.cern.ch/crab3/crab.sh

<span class="nb">cd</span> &lt;path_to_CMSSW&gt;
cmsenv

<span class="nb">cd</span> <span class="si">${</span><span class="nv">CMSSW_BASE</span><span class="si">}</span>/src
git clone -o upstream git@github.com:cp3-llbb/GridIn.git cp3_llbb/GridIn
git clone -o upstream git@github.com:cp3-llbb/SAMADhi.git cp3_llbb/SAMADhi
git clone -o upstream git@github.com:cp3-llbb/Datasets.git cp3_llbb/Datasets

scram b -j <span class="m">4</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">CMSSW_BASE</span><span class="si">}</span>/src/cp3_llbb/GridIn
<span class="nb">source</span> first_setup.sh
</pre></div>

<h1 id="how-to">How-to<a class="headerlink" href="#how-to" title="Permanent link">&para;</a></h1>
<p>The script you'll be working with is <code>runOnGrid.py</code>, from the <code>scripts</code> folder. During the first build, this script
is copied by CMSSW into the global <code>scripts</code> directory, which is inside <code>PATH</code>; you can thus access it from anywhere
in the source tree</p>
<p>In order to run on the grid, you need 3 things:</p>
<ul>
<li>First, an <code>analyzer</code> for the framework</li>
<li>A <code>configuration</code> file for this analyzer</li>
<li>A set of JSON files describing the datasets you want to run on</li>
</ul>
<p>The first two points must be handled by you. For the last point, a set of JSON files for the commonly used datasets are
already included (see inside <code>test/datasets</code>). The structure of the JSON file is described <a href="#json-file-format">below</a></p>
<p>You can now run on the grid. Go to the <code>test</code> folder, and run</p>
<div class="codehilite"><pre><span></span>runOnGrid.py -c &lt;Your_Configuration_File&gt; --mc datasets/mc_TT.json datasets/mc_DY.json &lt;datasets/...&gt;
</pre></div>

<p><code>&lt;Your_Configuration_File&gt;</code> must be substituted by the name of the configuration file, <em>including the <code>.py</code> extension</em>.
You should now have a new file inside the working directory, named <code>crab_TTJets_TuneCUETP8M1_amcatnloFXFX_25ns.py</code>.
This file is a configuration file for <code>crab3</code>. A file is created automatically for each dataset specified when running
 <code>runOnGrid.py</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>By default, <code>runOnGrid.py</code> does not submit any jobs to the grid, it only creates the necessary files for crab.</strong> If you want to automatically submit the jobs, you can add the <code>--submit</code> flag when running <code>runOnGrid.py</code> (<strong>does not seems to work for the moment due to a crab bug</strong>).</p>
</div>
<p>To manually launch the jobs, use the <code>crab submit &lt;crab_python_file&gt;</code>. All the submitted tasks are stored inside the <code>tasks</code> folder.</p>
<h1 id="book-keeping">Book-keeping<a class="headerlink" href="#book-keeping" title="Permanent link">&para;</a></h1>
<p>If the job has completed successfully, you can run
<div class="codehilite"><pre><span></span>runPostCrab.py &lt;myCrabConfigFile.py&gt;
</pre></div>
This will gather the needed information (number of events, code version, source dataset, ...) and insert the sample (and possibly the parent dataset if missing) in the database</p>
<h1 id="json-file-format">JSON file format<a class="headerlink" href="#json-file-format" title="Permanent link">&para;</a></h1>
<p>Each dataset is stored inside a JSON file, containing at least the dataset pretty name, its path as well as the number
of <em>units</em> per job. The meaning of <em>units</em> depends on the type of dataset: for <code>data</code>, a unit is a luminosity section.
For <code>MC</code>, a unit is a file.</p>
<p>An example of JSON file is given below:
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;/TTJets_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/RunIISpring15DR74-Asympt25ns_MCRUN2_74_V9-v1/MINIAODSIM&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TTJets_TuneCUETP8M1_amcatnloFXFX_25ns&quot;</span><span class="p">,</span>
    <span class="nt">&quot;units_per_job&quot;</span><span class="p">:</span> <span class="mi">15</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></p>
<p>It can contains any number of datasets, but by convention, only datasets belonging into the same group should be into
the same file (for example, it's fine to have one file for exclusive DY datasets, but not one file for all the different
TT samples). The root node must be a dictionary, where the key is the dataset path, and values are:</p>
<ul>
<li><code>name</code>: The pretty name of the dataset. This name is used to format the task name and the output path</li>
<li><code>units_per_job</code>: For <code>MC</code>, the number of files processed by each job. For <code>data</code>, the number of luminosity section
processed by each job.</li>
</ul>
<p>For a <code>data</code> JSON file, an additional value is mandatory:</p>
<ul>
<li><code>run_range</code>: must be an array with two entries, like <code>[1, 30]</code>, defining the range of validity of the dataset</li>
</ul>
<p>An optional value, but highly recommended is:</p>
<ul>
<li><code>certified_lumi_file</code>: the path (filename or url) of the golden JSON file containing certified luminosity section.
If not present, a default file will be used, presumably outdated by the time you'll run.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../fwk_jenkins/" title="Jenkins CI" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Jenkins CI
              </span>
            </div>
          </a>
        
        
          <a href="../plotit/" title="plotIt" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                plotIt
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 IRMP/CP3, Université catholique de Louvain
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/cp3-llbb" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>